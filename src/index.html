<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebGL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <style type="text/css" media="screen">
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <script id="baseVert" type="x-shader/x-vertex">
      precision mediump float;
      precision mediump int;

      varying vec3 eyeDirV;
      varying vec3 lightDirV;
      varying vec3 normalV;

      void main() {
        vec4 positionV = modelViewMatrix * vec4(position, 1.0);

        // There's no actual light in the scene so just hardcode some made-up coords...
        vec4 lightPosV = vec4(10.0);

        eyeDirV = -positionV.xyz;
        lightDirV = lightPosV.xyz - positionV.xyz;
        normalV = (modelViewMatrix * vec4(normal, 0.0)).xyz;

        gl_Position = projectionMatrix * positionV;
      }

    </script>

    <script id="cellFrag" type="x-shader/x-fragment">
      precision mediump float;
      precision mediump int;

      varying vec3 eyeDirV;
      varying vec3 lightDirV;
      varying vec3 normalV;

      void main() {
        vec3 N = normalize(normalV);
        vec3 E = normalize(eyeDirV);
        vec3 L = normalize(lightDirV);
        vec3 R = normalize(reflect(-E, N));

        if(max(dot(E, N), 0.0) < 0.3) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
          float i = max(dot(N, L), 0.0);
          vec3 color = vec3(1.0);
          vec3 kd = vec3(1, 0, 1);
          if (i > 0.9) {
              color = kd + vec3(0.4);
          } else if (i > 0.6 && i <= 0.9) {
              color = kd + vec3(0.2);
          } else if (i > 0.4 && i <= 0.6) {
              color = kd;
          } else if (i > 0.2 && i <= 0.4) {
              color = kd - vec3(0.2);
          } else {
              color = kd - vec3(0.4);
          }
          float spec = pow(max(dot(R, L), 0.0), 5.0);
          if(spec > 0.5) {
            color = kd + vec3(0.8);
          }
          gl_FragColor = vec4(color, 1.0);
        }
      }
    </script>
    <script src="js/three.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
